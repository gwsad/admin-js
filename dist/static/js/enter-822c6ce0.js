import{aa as ue,a5 as U,d as ie,C as u,a1 as re,ab as ce,ac as de,c as h,b as B,f as v,g as o,N as R,a as s,u as me,a8 as O,ad as w,r as i,o as r,H as L,J as A,e as C,ae as _e,a7 as k,af as pe,E as ve,P as fe,_ as ge}from"./index-d75711de.js";const be=[{prop:"categoryId",label:"卡片ID"},{prop:"name",label:"卡片名称"},{prop:"region",label:"卡片icon",slots:[{render(c,d,n){let m="";return n.facevalues.forEach(f=>{m+=f+" "}),[c(ue,{src:n.image},m)]}}]},{prop:"discount",label:"折扣"},{prop:"discount",label:"面值",slots:[{render(c,d,n){let m="";return n.facevalues.forEach(f=>{m+=f+" "}),[c("span",{vModel:n.isHot},m)]}}]},{prop:"isHot",label:"是否热门",slots:[{render(c,d,n){return[c("span",{vModel:n.isHot,inlinePrompt:!0,activeText:"是",inactiveText:"否",onClick(){d.emit("onChangeHot",n)}},n.isHot?"是":"否")]}}]},{prop:"option",label:"操作",width:"200px",slots:[{render(c,d,n){return[c(U,{type:"primary",size:"small",text:"上热门",onClick(){d.emit("onHot",n)}},n.isHot!==1?"上热门":"取消热门"),c(U,{type:"primary",text:"修改",size:"small",onClick(){d.emit("onEdit",n)}},"修改"),c(U,{type:"danger",text:"删除",size:"small",onClick(){d.emit("onDelete",n)}},"删除")]}}]}],ye={class:"bs"},Ce={class:"flex justify-center mb-10"},Ve=["src"],Ie={class:"dialog-footer"},Te=ie({__name:"enter",setup(c){const{VITE_GLOB_API_URL:d}={VITE_PORT:"8890",VITE_PUBLIC_PATH:"/",VITE_APP_DOMAIN:"innoempower.com",VITE_ROUTER_HISTORY:"hash",VITE_CDN:"false",VITE_COMPRESSION:"none",VITE_GLOB_API_URL:"http://54.92.26.95:7001",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},n=be,m=u([]),f=u({}),_=u(!1),M=d+"/admin/image/upload";re(()=>{S()});const g=u(0),V=u([]),S=async()=>{V.value=[];const e=await ce();g.value=e.data[0]._id,e.data.map(l=>{V.value.push({value:l._id,label:l.name})}),b()},b=async()=>{m.value=[];const{data:e}=await de(g.value,f.value);m.value=e},a=u({name:"",discount:null,facevalue:[],imageUrl:""}),z=e=>{g.value=e.props.name,b()},q=e=>{},F=e=>{O.confirm("确认修改该卡片是否热门吗？",{type:"warning"}).then(()=>{}).catch(()=>{})},K=()=>{p.value=[],_.value=!0},$=e=>{O.confirm("确认删除该卡片吗？",{type:"warning"}).then(async()=>{const l={name:e.name,image:e.image,discount:e.discount,order:e.order,isHot:e.isHot,isDelete:1};await w(e._id,l),b()}).catch(()=>{})},G=async()=>{if(a.value.facevalue=p.value,!a.value.name){k.error("请输入卡片名称");return}if(!a.value.discount){k.error("请输入卡片折扣");return}if(a.value.discount>100){k.error("卡片折扣输入不规范");return}if(!a.value.facevalue.length){k.error("请输入卡片面值");return}const e={name:a.value.name,image:a.value.imageUrl,discount:Number(a.value.discount),facevalues:a.value.facevalue,order:0,isHot:0};I.value==="新增卡片"?await pe(g.value,e):await w(D.value,e),b(),_.value=!1,I.value="新增卡片",D.value="",a.value={name:"",discount:null,facevalue:[],imageUrl:""}},j=e=>{a.value.imageUrl=d+e.data.filename},y=u(""),p=u([]),H=u(!1),N=u(),J=e=>{p.value.splice(p.value.indexOf(e),1)},Y=()=>{H.value=!0,ve(()=>{N.value.input.focus()})},P=()=>{y.value&&p.value.push(Number(y.value)),H.value=!1,y.value=""},Q=e=>{O.confirm(`确认${e.isHot===1?"取消":"上"}热门吗？`,{type:"warning"}).then(async()=>{const l={name:e.name,image:e.image,discount:e.discount,order:e.order,isHot:e.isHot===1?0:1,isDelete:e.isDelete};await w(e._id,l),b()}).catch(()=>{})},I=u("新增卡片"),D=u(""),W=e=>{D.value=e._id,I.value="修改卡片",p.value=e.facevalues,a.value={name:e.name,discount:e.discount,facevalue:e.facevalues,imageUrl:e.image},_.value=!0};return(e,l)=>{const X=i("el-tab-pane"),Z=i("el-tabs"),T=i("el-button"),ee=i("SrmTable"),x=i("el-input"),E=i("el-form-item"),ae=i("el-tag"),le=i("Plus"),te=i("el-icon"),ne=i("el-upload"),oe=i("el-form"),se=i("el-dialog");return r(),h("div",ye,[B("div",Ce,[V.value.length!==0?(r(),v(Z,{key:0,modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=t=>g.value=t),class:"demo-tabs mb-10",onTabClick:z},{default:o(()=>[(r(!0),h(L,null,A(V.value,t=>(r(),v(X,{key:t.value,label:t.label,name:t.value},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])):R("",!0)]),s(T,{class:"mb-20",type:"primary",onClick:K},{default:o(()=>[C("新增")]),_:1}),s(ee,{columns:me(n),sourceData:m.value,reqData:f.value,onOnDelete:$,onOnHot:Q,onOnEdit:W,onOnChangeHot:F,onCurrentChange:q},null,8,["columns","sourceData","reqData"]),_.value?(r(),v(se,{key:0,modelValue:_.value,"onUpdate:modelValue":l[5]||(l[5]=t=>_.value=t),title:I.value,width:"50%"},{footer:o(()=>[B("span",Ie,[s(T,{onClick:l[4]||(l[4]=t=>_.value=!1)},{default:o(()=>[C("取消")]),_:1}),s(T,{type:"primary",onClick:G},{default:o(()=>[C(" 确认 ")]),_:1})])]),default:o(()=>[s(oe,{model:a.value,"label-width":"100px"},{default:o(()=>[s(E,{label:"卡片名称："},{default:o(()=>[s(x,{modelValue:a.value.name,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.name=t),placeholder:"请输入卡片名称"},null,8,["modelValue"])]),_:1}),s(E,{label:"卡片折扣："},{default:o(()=>[s(x,{modelValue:a.value.discount,"onUpdate:modelValue":l[2]||(l[2]=t=>a.value.discount=t),type:"number",placeholder:"请输入卡片折扣"},null,8,["modelValue"])]),_:1}),s(E,{label:"卡片面值："},{default:o(()=>[(r(!0),h(L,null,A(p.value,t=>(r(),v(ae,{key:t,class:"mx-1",closable:"","disable-transitions":!1,onClose:Ee=>J(t)},{default:o(()=>[C(fe(t),1)]),_:2},1032,["onClose"]))),128)),H.value?(r(),v(x,{key:0,ref_key:"InputRef",ref:N,modelValue:y.value,"onUpdate:modelValue":l[3]||(l[3]=t=>y.value=t),type:"number",class:"ml-1 w-10",size:"small",onKeyup:_e(P,["enter"]),onBlur:P},null,8,["modelValue","onKeyup"])):(r(),v(T,{key:1,class:"button-new-tag ml-1",size:"small",onClick:Y},{default:o(()=>[C(" + New Tag ")]),_:1}))]),_:1}),s(E,{label:"卡片ICON："},{default:o(()=>[s(ne,{class:"avatar-uploader",action:M,"show-file-list":!1,"on-success":j},{default:o(()=>[a.value.imageUrl?(r(),h("img",{key:0,src:a.value.imageUrl,class:"avatar"},null,8,Ve)):(r(),v(te,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[s(le)]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])):R("",!0)])}}});const ke=ge(Te,[["__scopeId","data-v-950b0680"]]);export{ke as default};
