import{aa as ne,a5 as O,d as oe,C as c,a1 as se,ab as ue,ac as re,c as h,b as w,f as _,g as o,N,a as s,u as ce,a8 as D,ad as P,r as u,o as r,H as B,J as R,e as C,ae as ie,a7 as k,af as de,E as me,P as _e,_ as pe}from"./index-5551da34.js";const ve=[{prop:"categoryId",label:"卡片ID"},{prop:"name",label:"卡片名称"},{prop:"region",label:"卡片icon",slots:[{render(i,d,n){let m="";return n.facevalues.forEach(p=>{m+=p+" "}),[i(ne,{src:n.image},m)]}}]},{prop:"discount",label:"折扣"},{prop:"discount",label:"面值",slots:[{render(i,d,n){let m="";return n.facevalues.forEach(p=>{m+=p+" "}),[i("span",{vModel:n.isHot},m)]}}]},{prop:"isHot",label:"是否热门",slots:[{render(i,d,n){return[i("span",{vModel:n.isHot,inlinePrompt:!0,activeText:"是",inactiveText:"否",onClick(){d.emit("onChangeHot",n)}},n.isHot?"是":"否")]}}]},{prop:"option",label:"操作",width:"200px",slots:[{render(i,d,n){return[i(O,{type:"primary",size:"small",text:"上热门",onClick(){d.emit("onHot",n)}},n.isHot!==1?"上热门":"取消热门"),i(O,{type:"danger",text:"删除",size:"small",onClick(){d.emit("onDelete",n)}},"删除")]}}]}],fe={class:"bs"},ge={class:"flex justify-center mb-10"},be=["src"],ye={class:"dialog-footer"},Ce=oe({__name:"enter",setup(i){const{VITE_GLOB_API_URL:d}={VITE_PORT:"8890",VITE_PUBLIC_PATH:"/",VITE_APP_DOMAIN:"innoempower.com",VITE_ROUTER_HISTORY:"hash",VITE_CDN:"false",VITE_COMPRESSION:"none",VITE_GLOB_API_URL:"http://54.92.26.95:7001",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},n=ve,m=c([]),p=c({}),v=c(!1),L=d+"/admin/image/upload";se(()=>{A()});const f=c(0),V=c([]),A=async()=>{V.value=[];const e=await ue();f.value=e.data[0]._id,e.data.map(a=>{V.value.push({value:a._id,label:a.name})}),b()},b=async()=>{m.value=[];const{data:e}=await re(f.value,p.value);m.value=e},t=c({name:"",discount:null,facevalue:[],imageUrl:""}),M=e=>{f.value=e.props.name,b()},S=e=>{},z=e=>{D.confirm("确认修改该卡片是否热门吗？",{type:"warning"}).then(()=>{}).catch(()=>{})},q=()=>{g.value=[],v.value=!0},F=e=>{D.confirm("确认删除该卡片吗？",{type:"warning"}).then(async()=>{const a={name:e.name,image:e.image,discount:e.discount,order:e.order,isHot:e.isHot,isDelete:1};await P(e._id,a),b()}).catch(()=>{})},K=async()=>{if(t.value.facevalue=g.value,!t.value.name){k.error("请输入卡片名称");return}if(!t.value.discount){k.error("请输入卡片折扣");return}if(t.value.discount>100){k.error("卡片折扣输入不规范");return}if(!t.value.facevalue.length){k.error("请输入卡片面值");return}const e={name:t.value.name,image:t.value.imageUrl,discount:Number(t.value.discount),facevalues:t.value.facevalue,order:0,isHot:0};await de(f.value,e),b(),v.value=!1},$=e=>{t.value.imageUrl=d+e.data.filename},y=c(""),g=c([]),H=c(!1),x=c(),G=e=>{g.value.splice(g.value.indexOf(e),1)},j=()=>{H.value=!0,me(()=>{x.value.input.focus()})},U=()=>{y.value&&g.value.push(Number(y.value)),H.value=!1,y.value=""},J=e=>{D.confirm(`确认${e.isHot===1?"取消":"上"}热门吗？`,{type:"warning"}).then(async()=>{const a={name:e.name,image:e.image,discount:e.discount,order:e.order,isHot:e.isHot===1?0:1,isDelete:e.isDelete};await P(e._id,a),b()}).catch(()=>{})};return(e,a)=>{const Y=u("el-tab-pane"),Q=u("el-tabs"),I=u("el-button"),W=u("SrmTable"),E=u("el-input"),T=u("el-form-item"),X=u("el-tag"),Z=u("Plus"),ee=u("el-icon"),ae=u("el-upload"),le=u("el-form"),te=u("el-dialog");return r(),h("div",fe,[w("div",ge,[V.value.length!==0?(r(),_(Q,{key:0,modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=l=>f.value=l),class:"demo-tabs mb-10",onTabClick:M},{default:o(()=>[(r(!0),h(B,null,R(V.value,l=>(r(),_(Y,{key:l.value,label:l.label,name:l.value},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])):N("",!0)]),s(I,{class:"mb-20",type:"primary",onClick:q},{default:o(()=>[C("新增")]),_:1}),s(W,{columns:ce(n),sourceData:m.value,reqData:p.value,onOnDelete:F,onOnHot:J,onOnChangeHot:z,onCurrentChange:S},null,8,["columns","sourceData","reqData"]),v.value?(r(),_(te,{key:0,modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=l=>v.value=l),title:"新增卡片",width:"50%"},{footer:o(()=>[w("span",ye,[s(I,{onClick:a[4]||(a[4]=l=>v.value=!1)},{default:o(()=>[C("取消")]),_:1}),s(I,{type:"primary",onClick:K},{default:o(()=>[C(" 确认 ")]),_:1})])]),default:o(()=>[s(le,{model:t.value,"label-width":"100px"},{default:o(()=>[s(T,{label:"卡片名称："},{default:o(()=>[s(E,{modelValue:t.value.name,"onUpdate:modelValue":a[1]||(a[1]=l=>t.value.name=l),placeholder:"请输入卡片名称"},null,8,["modelValue"])]),_:1}),s(T,{label:"卡片折扣："},{default:o(()=>[s(E,{modelValue:t.value.discount,"onUpdate:modelValue":a[2]||(a[2]=l=>t.value.discount=l),type:"number",placeholder:"请输入卡片折扣"},null,8,["modelValue"])]),_:1}),s(T,{label:"卡片面值："},{default:o(()=>[(r(!0),h(B,null,R(g.value,l=>(r(),_(X,{key:l,class:"mx-1",closable:"","disable-transitions":!1,onClose:Ve=>G(l)},{default:o(()=>[C(_e(l),1)]),_:2},1032,["onClose"]))),128)),H.value?(r(),_(E,{key:0,ref_key:"InputRef",ref:x,modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=l=>y.value=l),type:"number",class:"ml-1 w-10",size:"small",onKeyup:ie(U,["enter"]),onBlur:U},null,8,["modelValue","onKeyup"])):(r(),_(I,{key:1,class:"button-new-tag ml-1",size:"small",onClick:j},{default:o(()=>[C(" + New Tag ")]),_:1}))]),_:1}),s(T,{label:"卡片ICON："},{default:o(()=>[s(ae,{class:"avatar-uploader",action:L,"show-file-list":!1,"on-success":$},{default:o(()=>[t.value.imageUrl?(r(),h("img",{key:0,src:t.value.imageUrl,class:"avatar"},null,8,be)):(r(),_(ee,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[s(Z)]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])):N("",!0)])}}});const Te=pe(Ce,[["__scopeId","data-v-433c8245"]]);export{Te as default};
