import{aa as se,a5 as x,d as ue,C as i,a1 as ie,ab as re,ac as ce,c as I,b as P,f as v,g as o,N as w,a as s,u as de,a8 as U,ad as B,r as u,o as r,H as R,J as L,e as C,ae as me,a7 as k,af as _e,E as pe,P as ve,_ as fe}from"./index-455ba8a9.js";const ge=[{prop:"categoryId",label:"卡片ID"},{prop:"name",label:"卡片名称"},{prop:"region",label:"卡片icon",slots:[{render(c,d,n){let m="";return n.facevalues.forEach(f=>{m+=f+" "}),[c(se,{src:n.image},m)]}}]},{prop:"discount",label:"折扣"},{prop:"discount",label:"面值",slots:[{render(c,d,n){let m="";return n.facevalues.forEach(f=>{m+=f+" "}),[c("span",{vModel:n.isHot},m)]}}]},{prop:"isHot",label:"是否热门",slots:[{render(c,d,n){return[c("span",{vModel:n.isHot,inlinePrompt:!0,activeText:"是",inactiveText:"否",onClick(){d.emit("onChangeHot",n)}},n.isHot?"是":"否")]}}]},{prop:"option",label:"操作",width:"200px",slots:[{render(c,d,n){return[c(x,{type:"primary",size:"small",text:"上热门",onClick(){d.emit("onHot",n)}},n.isHot!==1?"上热门":"取消热门"),c(x,{type:"primary",text:"修改",size:"small",onClick(){d.emit("onEdit",n)}},"修改"),c(x,{type:"danger",text:"删除",size:"small",onClick(){d.emit("onDelete",n)}},"删除")]}}]}],be={class:"bs"},ye={class:"flex justify-center mb-10"},Ce=["src"],Ve={class:"dialog-footer"},Te=ue({__name:"enter",setup(c){const{VITE_GLOB_API_URL:d}={VITE_PORT:"8890",VITE_PUBLIC_PATH:"/",VITE_APP_DOMAIN:"innoempower.com",VITE_ROUTER_HISTORY:"hash",VITE_CDN:"false",VITE_COMPRESSION:"none",VITE_GLOB_API_URL:"http://54.92.26.95:7001",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},n=ge,m=i([]),f=i({}),_=i(!1),A=d+"/admin/image/upload";ie(()=>{M()});const g=i(0),V=i([]),M=async()=>{V.value=[];const e=await re();g.value=e.data[0]._id,e.data.map(a=>{V.value.push({value:a._id,label:a.name})}),b()},b=async()=>{m.value=[];const{data:e}=await ce(g.value,f.value);m.value=e},l=i({name:"",discount:null,facevalue:[],imageUrl:""}),S=e=>{g.value=e.props.name,b()},z=e=>{},q=e=>{U.confirm("确认修改该卡片是否热门吗？",{type:"warning"}).then(()=>{}).catch(()=>{})},F=()=>{p.value=[],_.value=!0},K=e=>{U.confirm("确认删除该卡片吗？",{type:"warning"}).then(async()=>{const a={name:e.name,image:e.image,discount:e.discount,order:e.order,isHot:e.isHot,isDelete:1};await B(e._id,a),b()}).catch(()=>{})},$=async()=>{if(l.value.facevalue=p.value,!l.value.name){k.error("请输入卡片名称");return}if(!l.value.discount){k.error("请输入卡片折扣");return}if(l.value.discount>100){k.error("卡片折扣输入不规范");return}if(!l.value.facevalue.length){k.error("请输入卡片面值");return}const e={name:l.value.name,image:l.value.imageUrl,discount:Number(l.value.discount),facevalues:l.value.facevalue,order:0,isHot:0};await _e(g.value,e),b(),_.value=!1,H.value="新增卡片"},G=e=>{l.value.imageUrl=d+e.data.filename},y=i(""),p=i([]),h=i(!1),O=i(),j=e=>{p.value.splice(p.value.indexOf(e),1)},J=()=>{h.value=!0,pe(()=>{O.value.input.focus()})},N=()=>{y.value&&p.value.push(Number(y.value)),h.value=!1,y.value=""},Y=e=>{U.confirm(`确认${e.isHot===1?"取消":"上"}热门吗？`,{type:"warning"}).then(async()=>{const a={name:e.name,image:e.image,discount:e.discount,order:e.order,isHot:e.isHot===1?0:1,isDelete:e.isDelete};await B(e._id,a),b()}).catch(()=>{})},H=i("新增卡片"),Q=e=>{H.value="修改卡片",p.value=e.facevalues,l.value={name:e.name,discount:e.discount,facevalue:e.facevalues,imageUrl:e.image},_.value=!0};return(e,a)=>{const W=u("el-tab-pane"),X=u("el-tabs"),T=u("el-button"),Z=u("SrmTable"),D=u("el-input"),E=u("el-form-item"),ee=u("el-tag"),ae=u("Plus"),le=u("el-icon"),te=u("el-upload"),ne=u("el-form"),oe=u("el-dialog");return r(),I("div",be,[P("div",ye,[V.value.length!==0?(r(),v(X,{key:0,modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=t=>g.value=t),class:"demo-tabs mb-10",onTabClick:S},{default:o(()=>[(r(!0),I(R,null,L(V.value,t=>(r(),v(W,{key:t.value,label:t.label,name:t.value},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])):w("",!0)]),s(T,{class:"mb-20",type:"primary",onClick:F},{default:o(()=>[C("新增")]),_:1}),s(Z,{columns:de(n),sourceData:m.value,reqData:f.value,onOnDelete:K,onOnHot:Y,onOnEdit:Q,onOnChangeHot:q,onCurrentChange:z},null,8,["columns","sourceData","reqData"]),_.value?(r(),v(oe,{key:0,modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=t=>_.value=t),title:H.value,width:"50%"},{footer:o(()=>[P("span",Ve,[s(T,{onClick:a[4]||(a[4]=t=>_.value=!1)},{default:o(()=>[C("取消")]),_:1}),s(T,{type:"primary",onClick:$},{default:o(()=>[C(" 确认 ")]),_:1})])]),default:o(()=>[s(ne,{model:l.value,"label-width":"100px"},{default:o(()=>[s(E,{label:"卡片名称："},{default:o(()=>[s(D,{modelValue:l.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>l.value.name=t),placeholder:"请输入卡片名称"},null,8,["modelValue"])]),_:1}),s(E,{label:"卡片折扣："},{default:o(()=>[s(D,{modelValue:l.value.discount,"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.discount=t),type:"number",placeholder:"请输入卡片折扣"},null,8,["modelValue"])]),_:1}),s(E,{label:"卡片面值："},{default:o(()=>[(r(!0),I(R,null,L(p.value,t=>(r(),v(ee,{key:t,class:"mx-1",closable:"","disable-transitions":!1,onClose:Ee=>j(t)},{default:o(()=>[C(ve(t),1)]),_:2},1032,["onClose"]))),128)),h.value?(r(),v(D,{key:0,ref_key:"InputRef",ref:O,modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=t=>y.value=t),type:"number",class:"ml-1 w-10",size:"small",onKeyup:me(N,["enter"]),onBlur:N},null,8,["modelValue","onKeyup"])):(r(),v(T,{key:1,class:"button-new-tag ml-1",size:"small",onClick:J},{default:o(()=>[C(" + New Tag ")]),_:1}))]),_:1}),s(E,{label:"卡片ICON："},{default:o(()=>[s(te,{class:"avatar-uploader",action:A,"show-file-list":!1,"on-success":G},{default:o(()=>[l.value.imageUrl?(r(),I("img",{key:0,src:l.value.imageUrl,class:"avatar"},null,8,Ce)):(r(),v(le,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[s(ae)]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])):w("",!0)])}}});const ke=fe(Te,[["__scopeId","data-v-82c0caa4"]]);export{ke as default};
